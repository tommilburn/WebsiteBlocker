<script type="text/javascript">

	var blockList = ['reddit.com', 'google.com'];
	var blockingEnabled = false;

	safari.application.addEventListener("navigate", handleNavigate, true);

	function handleNavigate(event){
		console.log('is it gonna get blocked?');
		console.log(shouldBlock(event.target.url));
		if(shouldBlock(event.target.url) === true){
			console.log('blocking')
			event.target.page.dispatchMessage('block', 'page');
			console.log(event.target.page);
			console.log(event.target.page.dispatchMessage);
		};
	}

	function shouldBlock(url){
		for(var i = 0; i < blockList.length; i++){
			if((url.indexOf(blockList[i]) != -1) && (url.indexOf(blockList[i]) <= 12)){
				if(blockingEnabled){
					console.log("this site is gonna get blocked");
					return true;
				}
			}
		}
		return false;
	}

	function buildBlocklist(listString){
		blockList = listString.split('\n').trim();
	}
</script>