<script type="text/javascript">

	var blockList;
	var blockingEnabled = true;

	safari.application.addEventListener("navigate", handleNavigate, true);

	function handleNavigate(event){
		var url = event.target.url;
		console.log(event);
		blockList.forEach(function(listEntry){
			if(shouldBlock(event.target.url){
				event.preventDefault();
				console.log(event);
			});
		});
	}

	function shouldBlock(url){
		blockList.forEach(function(listEntry){
			if((url.indexOf(listEntry) != -1) && (url.indexOf(listEntry) <= 12)){ // 'https://www.' is twelve characters
				if(blockingEnabled){
					console.log("this site is gonna get blocked");
					return true;
				}
			}
		});
		return false;
	}

	function buildBlocklist(listString){
		blockList = listString.split('\n').trim();
	}
</script>